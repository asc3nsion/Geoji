<!-- 
This is an element button used as a base for other buttons.
 text = The text to be displayed on the button
 icon = The icon to be desplayed on the button
 iput = This is the id of the component the button will call a method on.

 style of the button is set via j-styles behavior.
 interaction is set via j-handler.
 if the button doesn't have an explicit id, one is assigned via auto-id.
-->
<!-- components: -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../elements/j-ui/j-button.html">
<link rel="import" href="../../elements/j-ui/j-profile-img.html">
<link rel="import" href="../../elements/j-ui/j-dialog.html">
<link rel="import" href="../../elements/api/imgur-upload.html">
<!-- behaviors: -->
<link rel="import" href="../../behaviors/style/j-styles.html">
<link rel="import" href="../../behaviors/interaction/j-handler.html">
<link rel="import" href="../../behaviors/selection/auto-id.html">

<style is="custom-style">

	paper-card{
		--paper-card-background-color: white;
	}
	

</style>	

<dom-module id= "geoji-card">
	<template>
		<!-- <firebase-document
	      id= "firebasePublicData"
	      location="{{publicURL}}"
	      query="{{publicData}}"
	      ></firebase-document> -->

	    <firebase-collection
	    	id= "firebasePublicData"
			limit-to-first="3"
		    location="https://geoji.firebaseio.com/public/"
		    data="{{publicData}}">
		</firebase-collection>

		    <template is="dom-repeat" items="[[publicData]]" as="data">
		      <h4>[[data.__firebaseKey__]]</h4>
		    </template>

		<paper-card id"{{assignCtrl('geojiCard')}}" heading="{{heading}}" image="{{cardImage}}">
		  <div class="card-content">{{detail}}</div>
		  <div class="card-actions">
		  	<template  is="dom-if" if="{{canShare}}"><paper-button id"{{assignCtrl('Share')}}">Share</paper-button></template>  
		    <a href="{{baseUrl}}mine/geoji"><paper-button id"{{assignCtrl('Explore')}}">Explore</paper-button></a>
		    <paper-button id"{{assignCtrl('Add')}}" on-tap="dataHandler">Add</paper-button>
		  </div>
		</paper-card>

	</template>
</dom-module>

<script>
	// I pass the button handler property from the base element, defined as the input
	// The call back is made via document.querySelector on the input element name.
	Polymer({		
		is: "geoji-card",
		properties: {
			cardImg: {
				type: String,
				value: ""
			},
			heading: {
				type: String,
				value: "GEOJI"
			},
			detail: {
				type: String,
				value: ""
			},
			description: {
				type: String,
				value: ""
			},
			canShare: {
				type: Boolean,
				value: true
			},
			publicURL: {
		        type: String,
		        computed: '_userURL()'
	      	},
	      	publicData: {
	      		type: Array,
	      		value: [],
	      		observer: "_dataCallback",
	      		notify: true
	      	}

			
		},

		behaviors:[StyleBehaviors.JStyles, InteractionBehaviors.JHandler, SelectionBehaviors.AutoId],

		ready: function(){

		},
		attached: function(){

			// var e = this.getElem(this.ctrls.profileImgInput);
			// var p = this.getElem(this.ctrls.profileImgUpload);
			// var self = this;

			// e.addEventListener('change', function() {
   //          	p.file = this.files[0];
	  //           console.log(e.file);
	  //       });
			// document.addEventListener('imgur-upload-success', function(e) {
	  //         console.log(e);
	  //         self.url = e.detail.link;
	  //         self.customUrl = e.detail.link;
	  //       });
	  //       document.addEventListener('imgur-upload-failure', function(e) {
	  //         console.log(e);
	  //         alert(e.detail.data.error);
	  //       });
		},
		dataHandler: function(){
			console.log(app.getUser());
			var user = app.getUser();
			var mainObj = {};
			var subObj = {};
			subObj[this.makeId()] = "test";
			mainObj.data = subObj;
			user.customData = mainObj;
			this.$.firebasePublicData.add(mainObj);
			console.log(this.publicData);
		},
		_publicURL: function(){

			if(!app.getUser()){
	          return null;
	        }else{
	          // return "https://geoji.firebaseio.com/public/";
	          return "https://geoji.firebaseio.com/users/" + this.user.uid + "/"
	        }     
	    },
	    _dataCallback: function(e){
	    	console.log("data recieved");
	    	console.log(e);
	    }

	});
</script>
